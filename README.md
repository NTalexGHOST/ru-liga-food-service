# Сервис доставки еды

Проект состоит из следующих элементов:
- Dependency Bom - содержит все зависимости проекта и их версии
- Common - модуль с общими элементами, вроде сущностей, DTO, репозиториев и т.д.
- Migration - модуль автоматического создания структуры БД и ее заполнения
- Order Service - по своей сути, основной модуль проект для создания и управления заказами
- Kitchen Service - модуль, имитирующий работу кухни ресторана
- Delivery Service - модуль, имитирующий работу службы доставки
- Notification Service - модуль для асинхронного общения сервисов между собой

## Тестовый сценарий работы проекта

Скопировать проект к себе на ПК, открыть папку как проект **IntelliJ IDEA**, в терминале IDE прописать cd migration и выполнить **mvn liquibase:update** для установки структуры БД и заполнения ее данными
> Предварительно удостоверьтесь в запущенном сервере **PostgreSQL 11** и **RabbitMQ**, по-умолчанию используется базовая БД **postgres** с данными для входа **postgres : password**

Теперь нужно запустить сами сервисы, обычно IntelliJ IDEA сама подкручивает конфигурацию запуска сервисов после запуска mvn clean compile (mvn clean package) в центральной директории проекта
> Вернуться можно с помощью **cd ..**

Всё взаимодействие реализуется посредством использования **Swagger** по пути **localhost:<порт сервиса>/swagger-ui**
- **delivery-service** - **8081**
- **kitchen-service** - **8082**
- **notification-service** - **8083** никакого ручного взаимодействия с ним нет
- **order-service** - **8084**

Первым делом открываем **localhost:8084/swagger-ui** для управления заказами, где нас встречает 7 endpoint`ов:
> Все начальные данные БД для удобства можно просмотреть в **migration\src\main\resources\db\changelog\init-values\v01**
- **/order-service/order/{id}** - возвращает всю информацию по конкретному заказу
- **/order-service/order** - позволяет создать новый заказ с помощью отправления простой DTO
- с помощью **/order-service/order/{id}/status** и **/order-service/order/{id}** можно просмотреть или изменить статус конкретного заказа
- **/order-service/order/{id}/pay** и **/order-service/order/{id}/cancel** по сути зайдействуют прошлый endpoint для изменения статуса

При вызове метода оплаты заказа он будет асинхронно отправлен в kitchen-service, где будет уже 3 небольших endpoint`а для изменения статуса:
**/kitchen-service/kitchen/{orderId}/accept** **/kitchen-service/kitchen/{orderId}/decline** **/kitchen-service/kitchen/{orderId}/ready**
> К сожалению, при вызове данных endpoint`ов **Rabbit** ведет себя странно и отказывается передавать сообщения в **order-service**, о чем в кратце написал чуть далее

Для успешного прохождения далее, заказ нужно сначала принять и приготовить, после чего будет асинхронно отправлено сообщение к **delivery-service**
При получении сообщения **delivery-service** найдет всех свободных курьеров, вычислит их расстояние до ресторана и выведет все это в консоль (по сути имитация их оповещения)

В самом же сервисе есть 3 endpoint`а, 2 из которых по своей сути просто изменяют статус доставки на принятый в доставку и завершенный
- **/delivery-service/delivery/{orderId}/take**
- **/delivery-service/delivery/{orderId}/complete**
Также, данный сервис позволяет просмотреть все заказы, которые ждут своего курьера **/delivery-service/deliveries**
> Я здесь не учел как минимум один момент, реализацию взял от изначального проекта и не изменял из-за нехватки времени, данный метод выступал в роли выдачи всех выполненных заказов с вычислением расстояний от курьера до ресторана и от него до покупателя, а также платы, которую получит курьер на основе стоимости заказа

После выполнения **complete** жизненный цикл заказа считай завершается


## Некоторые возникшие проблемы

- Почему-то **Rabbit** не работает при попытке отправить сообщение в **order-service**, при этом та же отправка от **order-service** к **kitchen-service** прекрасно выполняется, заметил лишь к концу дедлайна, узнать причину проблемы и починить ее не смог
> При этом сообщение приходит в **notification-service**, но дальше в сам **order-service** не уходит

- Также, нет каких-либо тестов, логирование и документирование лишь частичное и пытался прикрутить Security, но банально не успел все это к дедлайну(
